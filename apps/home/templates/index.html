{% extends 'layouts/base.html' %}

{% block title %}Transacciones{% endblock title %}

{% block content %}
<div class="row">
	<!-- ? Card efectivo -->
	<div class="col-12 col-sm-6 col-xl-6 mb-4">
		<div class="card border-0 shadow">
			<div class="card-body">
				<div class="row d-block d-xl-flex align-items-center">
					<div class="col-12 col-xl-5 text-xl-center mb-3 mb-xl-0 d-flex align-items-center justify-content-xl-center">
						<div class="icon-shape icon-shape-success rounded me-4 me-sm-0">
							<i class="fas fa-money-bill"></i>
						</div>
					</div>
					<div class="col-12 col-xl-7 px-xl-0 fw-bold">
						<div class="d-none d-sm-block">
							<h3 class="fw-extrabold mb-2">Efectivo</h3>
						</div>
						<table class="table table-centered table-hover table-nowrap mt-4 mb-0 border-0 rounded info">
							<thead class="thead-light">
								<tr>
									<th class="border-0 rounded-start">Ingresos</th>
									<th class="border-0">Egresos</th>
									<th class="border-0 rounded-end">Total</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>
										<p class="text-success">
											$000
										</p>
									</td>
									<td>
										<p class="text-danger">
											$000
										</p>
									</td>
									<td>
										<p class="text-primary">
											$000
										</p>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<button class="btn btn-primary footer rounded-0 rounded-bottom" id="detalles-efectivo-btn">Detalles</button>
		</div>
	</div>
	<!-- ? ./Card efectivo -->

	<!-- ? Card tarjeta -->
	<div class="col-12 col-sm-6 col-xl-6 mb-4">
		<div class="card border-0 shadow">
			<div class="card-body">
				<div class="row d-block d-xl-flex align-items-center">
					<div class="col-12 col-xl-5 text-xl-center mb-3 mb-xl-0 d-flex align-items-center justify-content-xl-center">
						<div class="icon-shape icon-shape-info rounded me-4 me-sm-0">
							<i class="fas fa-credit-card"></i>
						</div>
					</div>
					<div class="col-12 col-xl-7 px-xl-0 fw-bold">
						<div class="d-none d-sm-block">
							<h3 class="fw-extrabold mb-2">Tarjeta</h3>
						</div>
						<table class="table table-centered table-hover table-nowrap mt-4 mb-0 border-0 rounded info">
							<thead class="thead-light">
								<tr>
									<th class="border-0 rounded-start">Ingresos</th>
									<th class="border-0">Egresos</th>
									<th class="border-0 rounded-end">Total</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>
										<p class="text-success">
											$000
										</p>
									</td>
									<td>
										<p class="text-danger">
											$000
										</p>
									</td>
									<td>
										<p class="text-primary">
											$000
										</p>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<button class="btn btn-primary footer rounded-0 rounded-bottom" id="detalles-tarjeta-btn">Detalles</button>
		</div>
	</div>
	<!-- ? ./Card tarjeta -->
</div>

<div class="card border-0 shadow mb-4 m-auto">
	<div class="card-body table-responsive">
		<table class="table table-centered table-hover table-nowrap mb-0 border-0 rounded text-center" id="transacciones">
			<thead class="thead-light">
				<tr>
					<th class="border-0 rounded-start">#</th>
					<th class="border-0">Categoria</th>
					<th class="border-0">Fecha</th>
					<th class="border-0">Monto</th>
					<th class="border-0">Descripcion</th>
					<th class="border-0">Editar</th>
					<th class="border-0 rounded-end">Eliminar</th>
				</tr>
			</thead>
			<tbody>
				{% for transaccion in transacciones %}
				<tr>
					<td>{{ forloop.counter }}</td>
					<td class="fw-bold align-items-center">
						<i class="fas {{ transaccion.category.icon }} text-muted me-2"></i>
						{{ transaccion.category.name }}
					</td>
					<td>
						{% if transaccion.date == today%}Hoy{% else %}{{ transaccion.date }}{% endif %}
					</td>
					<td>
						<p class="fw-bold text-{% if transaccion.category.type == 1 %}success{% else %}danger{% endif %}">
							${{ transaccion.amount }}
						</p>
					</td>
					<td>{{ transaccion.description }}</td>
					<td>
						<button class="btn btn-sm btn-primary editar-btn" name="editar" data-id="{{transaccion.id}}">
							<i class=" fas fa-edit icon-sx"></i>
							Editar
						</button>
					</td>
					<td>
						<form action="{% url 'acciones' transaccion.id %}" method="get">
							<button class="btn btn-sm btn-danger eliminar-btn" name="eliminar" data-id="{{transaccion.id}}">
								<i class="fas fa-trash icon-sx"></i>
								Eliminar
							</button>
						</form>
					</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
	<div class="card-footer row text-center fw-bold">
		<div class="col-4 text-success">Ingresos: ${{ingresos}}</div>
		<div class="col-4 text-danger">Egresos: ${{egresos}}</div>
		<div class="col-4 text-primary">Total:${{total}}</div>
	</div>
</div>

<!-- ? Modal ingresos -->
<div class="modal fade" id="modal-ingresos">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<h2 class="h4 modal-title w-100 text-center">Ingresos</h2>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body modal-body-ingresos">
				<!-- Cuerpo en ingresos.html -->
			</div>
		</div>
	</div>
</div>
<!-- ? ./Modal ingresos -->

<!-- ? Modal egresos -->
<div class="modal fade" id="modal-egresos">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<h2 class="h4 modal-title w-100 text-center">Egresos</h2>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body modal-body-egresos">
				<!-- Cuerpo en egresos.html -->
			</div>
		</div>
	</div>
</div>
<!-- ? ./Modal egresos -->

<!-- ? Modal editar -->
<div class="modal fade" id="modal-editar">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<h2 class="h4 modal-title w-100 text-center">Editar</h2>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body modal-body-editar">
				<!-- Cuerpo en editar.html -->
			</div>
		</div>
	</div>
</div>
<!-- ? ./Modal editar -->
{% endblock content %}


{% block javascripts %}
<script>
	$("#transacciones").DataTable({
		"responsive": true,
		"autoWidth": false,
		"ordering": false,
		"paging": false,
		"language": {
			"info": "Mostrando _START_ a _END_ de _TOTAL_ totales",
			"infoEmpty": "Mostrando 0 a 0 de 0 entradas",
			"infoFiltered": "(filtrado de _MAX_ registros totales)",
			"zeroRecords": "No se encontraron registros coincidentes",
			"emptyTable": "Aun no se han registrado gastos / ingresos",
			"search": "Buscar:",
			"loadingRecords": "Cargando...",
			"processing": "Procesando...",
		},
	});

	// Estilos personalizados para componentes de datatables
	$("#transacciones_filter").addClass("pb-2 pe-0");
	$("#transacciones_filter input").addClass("form-control-sm");
	$("#transacciones_info").addClass("pt-4 ps-0");

	// Agregar un ingreso
	$("#ingresos-btn").on("click", function () {
		$.ajax({
			url: 'ingreso',
			type: 'GET',
			success: function (data) {
				$('#modal-ingresos').modal('show');
				$('#modal-ingresos .modal-body-ingresos').html(data);
			}
		});
	});

	// Agregar un egreso
	$("#egresos-btn").on("click", function () {
		$.ajax({
			url: 'egreso',
			type: 'GET',
			success: function (data) {
				$('#modal-egresos').modal('show');
				$('#modal-egresos .modal-body-egresos').html(data);
			}
		});
	});

	// Editar un registro
	$(".editar-btn").on("click", function () {
		id = $(this).data("id");
		$.ajax({
			url: `acciones/${id}`,
			type: 'GET',
			success: function (data) {
				$('#modal-editar').modal('show');
				$('#modal-editar .modal-body-editar').html(data);
			}
		});
	});

</script>
{% endblock javascripts %}